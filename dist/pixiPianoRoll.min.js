!function(e,i){"function"==typeof define&&define.amd?define(["pixi.js","teoria","musical-scale-colors"],i):"object"==typeof exports?module.exports=i(require("pixi.js"),require("teoria"),require("musical-scale-colors")):e.pixiPianoRoll=i(e.PIXI,e.teoria,e.musicalScaleColors)}(this,function(e,i,r){"use strict";function t(t){function o(e){var r=i.note["from"+t.noteFormat](e);return"Frequency"===t.noteFormat?r.note:r}function a(){var e=void 0,i=void 0,r=!0,a=!1,l=void 0;try{for(var c,d=t.noteData[Symbol.iterator]();!(r=(c=d.next()).done);r=!0){var h=n(c.value,2),u=h[1],v=o(u).key();(e>v||"number"!=typeof e)&&(e=v),(v>i||"number"!=typeof i)&&(i=v)}}catch(f){a=!0,l=f}finally{try{!r&&d["return"]&&d["return"]()}finally{if(a)throw l}}return{min:e-1,max:i}}function l(){var r=[],n=[],o=t.pianoKeyWidth/1.575;I.removeChild(F),F=new e.Container;for(var a=x.min;a<x.max+2;a++){var l=t.height+(x.min-a)*k,c=i.note.fromKey(a),d=c.chroma();new Set([0,2,4,5,7,9,11]).has(d)?r.push({y:l+(new Set([4,11]).has(d)?0:-k/2),width:t.pianoKeyWidth,height:new Set([2,7,9]).has(d)?2*k:1.5*k,color:s.white}):n.push({y:l,width:o,height:k,color:s.black})}r.concat(n).forEach(function(i){F.addChild((new e.Graphics).beginFill(i.color).lineStyle(i.color===s.white?j:0,s.black).drawRect(0,i.y,i.width,i.height).endFill())}),I.addChild(F)}function c(){I.addChild((new e.Graphics).beginFill(t.backgroundColor).drawRect(0,0,t.width,t.height).endFill())}function d(e,i){if(!e)return 0;var r=e.split(":"),o=n(r,3),a=o[0],l=o[1],c=void 0===l?0:l,d=o[2],h=void 0===d?0:d,u=S*a+K*c+W*h;return i?u:t.pianoKeyWidth-u}function h(){var r=O.removeChild(g);g=new e.Container;var a=!0,l=!1,c=void 0;try{for(var h,u=function(){var r=n(h.value,3),a=r[0],l=r[1],c=r[2],u=t.noteColor,v=new e.Graphics,f=o(l),y=d(a,!0)+D,m=t.height-(f.key()-x.min)*k+D,s=S/parseInt(c);"object"==typeof u&&Object.keys(u).forEach(function(e){i.note(e).chroma()===f.chroma()&&(u=u[e])}),g.addChild(v),v.beginFill(u).drawRect(y,m,s,z).endFill()},v=t.noteData[Symbol.iterator]();!(a=(h=v.next()).done);a=!0)u()}catch(f){l=!0,c=f}finally{try{!a&&v["return"]&&v["return"]()}finally{if(l)throw c}}g.x=r?r.x:d(t.time),O.addChild(g),I.addChild(O)}function u(e){if("string"!=typeof e)return u("horizontal"),void u("vertical");var i="vertical"===e?j:t.width,r="vertical"===e?t.height:j,n=!0,o=!1,a=void 0;try{for(var l,c=G[e][Symbol.iterator]();!(n=(l=c.next()).done);n=!0){var d=l.value;d.graphic.clear().beginFill(t.gridLineColor).drawRect(d.x,d.y,i,r).endFill()}}catch(h){o=!0,a=h}finally{try{!n&&c["return"]&&c["return"]()}finally{if(o)throw a}}}function v(e){var i=!0,r=!1,n=void 0;try{for(var o,a=G.vertical[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var l=o.value;l.x=l.x-e}}catch(c){r=!0,n=c}finally{try{!i&&a["return"]&&a["return"]()}finally{if(r)throw n}}if(G.vertical[0].x+j<t.pianoKeyWidth){var l=G.vertical.shift();l.x=G.vertical[G.vertical.length-1].x+q,G.vertical.push(l)}else if(G.vertical[G.vertical.length-1].x>t.width){var l=G.vertical.pop();l.x=G.vertical[0].x-q,G.vertical.unshift(l)}}function f(i){var r=void 0;if(!i||"horizontal"===i){for(E.main.removeChild(E.horizontal),E.horizontal=new e.Container,G.horizontal=[],r=0;C+1>r;r++){var o=new e.Graphics;G.horizontal.push({x:0,y:r*k-D,graphic:o}),E.horizontal.addChild(o)}E.main.addChild(E.horizontal)}if(!i||"vertical"===i){for(E.main.removeChild(E.vertical),E.vertical=new e.Container,G.vertical=[],r=0;r<t.zoom*t.resolution+1;r++){var o=new e.Graphics,a=t.time.split(":"),l=n(a,3),c=(l[0],l[1]),d=void 0===c?0:c,h=l[2],u=void 0===h?0:h,v=d*K+u*W;G.vertical.push({x:r*q-D-v+t.pianoKeyWidth,y:0,graphic:o}),E.vertical.addChild(o)}E.main.addChild(E.vertical)}O.addChild(E.main)}function y(e){p||(p=e);var i=e-p,r=i*w;g.x=g.x-r,v(r),u("vertical"),p=e,A.render(I),R?requestAnimationFrame(y):p=null}function m(){x=a(t.noteData),C=x.max-x.min,S=(t.width-t.pianoKeyWidth)/t.zoom,K=(t.width-t.pianoKeyWidth)/(4*t.zoom),W=K/4,j=S/100,D=j/2,q=S/t.resolution,b=t.bpm/60/1e3,w=K*b,k=t.height/C,z=k-j}var s={black:0,white:16777215};t=Object.assign({width:900,height:400,pianoKeyWidth:125,noteColor:r.dDJameson,gridLineColor:3355443,backgroundColor:s.black,bpm:140,antialias:!0,zoom:4,resolution:2,time:"0:0:0",renderer:"WebGLRenderer",noteFormat:"String",noteData:[]},t);var p=void 0,b=void 0,w=void 0,g=void 0,x=void 0,C=void 0,k=void 0,z=void 0,F=void 0,S=void 0,K=void 0,W=void 0,j=void 0,D=void 0,q=void 0,G={},R=!1,A=new e[t.renderer](t.width,t.height,{antialias:t.antialias}),I=new e.Container,O=new e.Container,E={main:new e.Container};!function(){m(),c(),f(),u(),h(),l(),A.render(I)}();var L=Object.defineProperties({playback:{toggle:function(e){R?L.playback.pause():L.playback.play(e)},play:function(e){R||(e&&L.playback.seek(e),R=!0,requestAnimationFrame(y))},pause:function(){R=!1},seek:function(e){var i=d(e),r=g.x-i;v(r),g.x=i,A.render(I)}}},{bpm:{set:function(e){t.bpm=e,m()},configurable:!0,enumerable:!0},noteData:{set:function(e){t.noteData=e,m(),f("horizontal"),u("horizontal"),h(),l(),A.render(I)},configurable:!0,enumerable:!0},playing:{get:function(){return R},configurable:!0,enumerable:!0},view:{get:function(){return A.view},configurable:!0,enumerable:!0}});return L}var n=function(){function e(e,i){var r=[],t=!0,n=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(t=(a=l.next()).done)&&(r.push(a.value),!i||r.length!==i);t=!0);}catch(c){n=!0,o=c}finally{try{!t&&l["return"]&&l["return"]()}finally{if(n)throw o}}return r}return function(i,r){if(Array.isArray(i))return i;if(Symbol.iterator in Object(i))return e(i,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();return t});