!function(e,r){"function"==typeof define&&define.amd?define(["pixi.js","teoria","musical-scale-colors"],r):"object"==typeof exports?module.exports=r(require("pixi.js"),require("teoria"),require("musical-scale-colors")):e.pixiPianoRoll=r(e.PIXI,e.teoria,e.musicalScaleColors)}(this,function(e,r,t){"use strict";function i(i){function o(e){var t=r.note["from"+i.noteFormat](e);return"Frequency"===i.noteFormat?t.note:t}function a(){var e,r;return i.noteData.forEach(function(t){var i=o(t[1]).key();(e>i||"number"!=typeof e)&&(e=i),(i>r||"number"!=typeof r)&&(r=i)}),{min:e-1,max:r}}function l(){for(var t=[],n=[],o=j/2*F,a=o/1.575,l=k.min+1;l<k.max+2;l++){var c=i.height+(k.min-l)*I,u=r.note.fromKey(l),h=u.chroma();new Set([0,2,4,5,7,9,11]).has(h)?t.push({y:c+(new Set([4,11]).has(h)?0:-I/2),width:o,height:new Set([2,7,9]).has(h)?2*I:1.5*I,color:y.white}):n.push({y:c,width:a,height:I,color:y.black})}t.concat(n).forEach(function(r){x.addChild((new e.Graphics).beginFill(r.color).lineStyle(r.color===y.white?D:0,y.black).drawRect(0,r.y,r.width,r.height).endFill())}),b.addChild(x)}function c(){C.addChild((new e.Graphics).beginFill(i.backgroundColor).drawRect(0,0,i.width,i.height).endFill())}function u(e){var r=e.split(":"),t=n(r,3),i=t[0],o=t[1],a=void 0===o?0:o,l=t[2],c=void 0===l?0:l;return j*i+z*a+q*c}function h(){var t=!0,a=!1,l=void 0;try{for(var c,h=function(){var t=n(c.value,3),a=t[0],l=t[1],h=t[2],d=i.noteColor,f=new e.Graphics,v=o(l),s=u(a)+A,y=i.height-(v.key()-k.min)*I+A,m=j/parseInt(h);"object"==typeof d&&Object.keys(d).forEach(function(e){r.note(e).chroma()===v.chroma()&&(d=d[e])}),g.addChild(f),f.beginFill(d).drawRect(s,y,m,O).endFill()},d=i.noteData[Symbol.iterator]();!(t=(c=d.next()).done);t=!0)h()}catch(f){a=!0,l=f}finally{try{!t&&d["return"]&&d["return"]()}finally{if(a)throw l}}g.x=-u(i.time),C.addChild(g),C.width=C.width*F,C.x=i.width*(1-F),b.addChild(C)}function d(e){if("string"!=typeof e)return d("horizontal"),void d("vertical");var r="vertical"===e?D:i.width,t="vertical"===e?i.height:D,n=!0,o=!1,a=void 0;try{for(var l,c=L[e][Symbol.iterator]();!(n=(l=c.next()).done);n=!0){var u=l.value;u.graphic.clear().beginFill(i.gridLineColor).drawRect(u.x,u.y,r,t).endFill()}}catch(h){o=!0,a=h}finally{try{!n&&c["return"]&&c["return"]()}finally{if(o)throw a}}}function f(e){var r=!0,t=!1,i=void 0;try{for(var n,o=L.vertical[Symbol.iterator]();!(r=(n=o.next()).done);r=!0){var a=n.value;a.x=a.x-e}}catch(l){t=!0,i=l}finally{try{!r&&o["return"]&&o["return"]()}finally{if(t)throw i}}if(L.vertical[0].x+D<0){var a=L.vertical.shift();a.x=L.vertical[L.vertical.length-1].x+E,L.vertical.push(a)}}function v(){var r=void 0;for(r=0;S+1>r;r++){var t=new e.Graphics;L.horizontal.push({x:0,y:r*I-A,graphic:t}),C.addChild(t)}for(r=0;r<i.zoom*i.resolution+1;r++){var t=new e.Graphics,o=i.time.split(":"),a=n(o,3),l=(a[0],a[1]),c=void 0===l?0:l,u=a[2],h=void 0===u?0:u,d=c*z+h*q;L.vertical.push({x:r*E-A-d,y:0,graphic:t}),C.addChild(t)}}function s(e){m||(m=e);var r=e-m,t=r*R;g.x=g.x-t,f(t),d("vertical"),m=e,w.render(b),p?requestAnimationFrame(s):m=null}var y={black:0,white:16777215};i=Object.assign({width:900,height:400,noteColor:t.dDJameson,gridLineColor:3355443,backgroundColor:y.black,bpm:140,antialias:!0,zoom:4,resolution:2,time:"0:0:0",renderer:"WebGLRenderer",noteFormat:"String",noteData:[]},i);var m=void 0,p=!1,w=new e[i.renderer](i.width,i.height,{antialias:i.antialias}),b=new e.Container,g=new e.Container,x=new e.Container,C=new e.Container,F=.89,k=a(i.noteData),S=k.max-k.min,j=i.width/i.zoom,z=i.width/(4*i.zoom),q=z/4,G=i.bpm/60/1e3,R=z*G,D=j/100,A=D/2,E=j/i.resolution,I=i.height/S,O=I-D,L={horizontal:[],vertical:[]};c(),v(),d(),h(),l(),w.render(b);var P=Object.defineProperties({playback:{toggle:function(){p?P.playback.pause():P.playback.play()},play:function(){p=!0,requestAnimationFrame(s)},pause:function(){p=!1}}},{playing:{get:function(){return p},configurable:!0,enumerable:!0},view:{get:function(){return w.view},configurable:!0,enumerable:!0}});return P}var n=function(){function e(e,r){var t=[],i=!0,n=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(i=(a=l.next()).done)&&(t.push(a.value),!r||t.length!==r);i=!0);}catch(c){n=!0,o=c}finally{try{!i&&l["return"]&&l["return"]()}finally{if(n)throw o}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();return i});