!function(e,i){"function"==typeof define&&define.amd?define(["pixi.js","teoria","musical-scale-colors"],i):"object"==typeof exports?module.exports=i(require("pixi.js"),require("teoria"),require("musical-scale-colors")):e.pixiPianoRoll=i(e.PIXI,e.teoria,e.musicalScaleColors)}(this,function(e,i,n){"use strict";function r(r){function t(e){var n=i.note["from"+r.noteFormat](e);return"Frequency"===r.noteFormat?n.note:n}function a(){var e=void 0,i=void 0,n=!0,a=!1,l=void 0;try{for(var d,c=r.noteData[Symbol.iterator]();!(n=(d=c.next()).done);n=!0){var u=o(d.value,2),h=u[1],f=t(h).key();(e>f||"number"!=typeof e)&&(e=f),(f>i||"number"!=typeof i)&&(i=f)}}catch(v){a=!0,l=v}finally{try{!n&&c["return"]&&c["return"]()}finally{if(a)throw l}}return{min:e-1,max:i}}function l(){var n=[],o=[],t=r.pianoKeyWidth/1.575;q.removeChild(F),F=new e.Container;for(var a=C.min;a<C.max+2;a++){var l=r.height+(C.min-a)*x,d=i.note.fromKey(a),c=d.chroma();new Set([0,2,4,5,7,9,11]).has(c)?n.push({y:l+(new Set([4,11]).has(c)?0:-x/2),width:r.pianoKeyWidth,height:new Set([2,7,9]).has(c)?2*x:1.5*x,color:s.white}):o.push({y:l,width:t,height:x,color:s.black})}n.concat(o).forEach(function(i){F.addChild((new e.Graphics).beginFill(i.color).lineStyle(i.color===s.white?x/10:0,s.black).drawRect(0,i.y,i.width,i.height).endFill())}),q.addChild(F)}function d(e,i){if(!e)return 0;var n=e.split(":"),t=o(n,3),a=t[0],l=t[1],d=void 0===l?0:l,c=t[2],u=void 0===c?0:c,h=z*a+S*d+K*u;return i?h:r.pianoKeyWidth-h}function c(){var n=A.removeChild(w);w=new e.Container;var a=!0,l=!1,c=void 0;try{for(var u,h=function(){var n=o(u.value,3),a=n[0],l=n[1],c=n[2],h=r.noteColor,f=new e.Graphics,v=t(l),m=d(a,!0)+j,s=r.height-(v.key()-C.min)*x+j,y=z/parseInt(c);"object"==typeof h&&Object.keys(h).forEach(function(e){i.note(e).chroma()===v.chroma()&&(h=h[e])}),w.addChild(f),f.beginFill(h).drawRect(m,s,y,k).endFill()},f=r.noteData[Symbol.iterator]();!(a=(u=f.next()).done);a=!0)h()}catch(v){l=!0,c=v}finally{try{!a&&f["return"]&&f["return"]()}finally{if(l)throw c}}w.x=n?n.x:d(r.time),A.addChild(w),q.addChild(A)}function u(e){var i=G.vertical.children,n=!0,o=!1,t=void 0;try{for(var a,l=i[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var d=a.value;d.x-=e}}catch(c){o=!0,t=c}finally{try{!n&&l["return"]&&l["return"]()}finally{if(o)throw t}}if(i[0].x+W<r.pianoKeyWidth){var d=G.vertical.removeChildAt(0);d.x=i[i.length-1].x+D,G.vertical.addChild(d)}}function h(e){for(var i=e;i+D<r.pianoKeyWidth;)i+=D;return i}function f(i){var n=void 0;if(!i||"horizontal"===i){for(G.main.removeChild(G.horizontal),G.horizontal=new e.Container,n=0;g+1>n;n++)G.horizontal.addChild((new e.Graphics).beginFill(r.gridLineColor).drawRect(0,n*x-j,r.width,W).endFill());G.main.addChild(G.horizontal)}if(!i||"vertical"===i){var o=h(w?w.x:d(r.time));for(G.main.removeChild(G.vertical),G.vertical=new e.Container,n=0;n<r.zoom*r.resolution+1;n++){var t=(new e.Graphics).beginFill(r.gridLineColor).drawRect(0,0,W,r.height).endFill();t.x=o+n*D-j,G.vertical.addChild(t)}G.main.addChild(G.vertical)}A.addChild(G.main)}function v(e){y||(y=e);var i=e-y,n=i*p;w.x=w.x-n,u(n),y=e,I.render(q),R?requestAnimationFrame(v):y=null}function m(){C=a(r.noteData),g=C.max-C.min,z=(r.width-r.pianoKeyWidth)/r.zoom,S=(r.width-r.pianoKeyWidth)/(4*r.zoom),K=S/4,W=z/100,j=W/2,D=z/r.resolution,b=r.bpm/60/1e3,p=S*b,x=r.height/g,k=x-W}var s={black:0,white:16777215};r=Object.assign({width:900,height:400,pianoKeyWidth:125,noteColor:n.dDJameson,gridLineColor:3355443,backgroundColor:s.black,bpm:140,antialias:!0,zoom:4,resolution:2,time:"0:0:0",renderer:"WebGLRenderer",noteFormat:"String",noteData:[]},r);var y=void 0,b=void 0,p=void 0,w=void 0,C=void 0,g=void 0,x=void 0,k=void 0,F=void 0,z=void 0,S=void 0,K=void 0,W=void 0,j=void 0,D=void 0,R=!1,q=new e.Container,A=new e.Container,G={main:new e.Container},I=new e[r.renderer](r.width,r.height,{antialias:r.antialias,autoResize:!0});!function(){m(),f(),c(),l(),I.backgroundColor=r.backgroundColor,I.render(q)}();var L=Object.defineProperties({playback:{toggle:function(e){R?L.playback.pause():L.playback.play(e)},play:function(e){R||(e&&L.playback.seek(e),R=!0,requestAnimationFrame(v))},pause:function(){R=!1},seek:function(e){r.time=e,w.x=d(e),f("vertical"),A.addChild(A.removeChild(w)),I.render(q)}}},{bpm:{set:function(e){r.bpm=e,m()},configurable:!0,enumerable:!0},zoom:{set:function(e){r.zoom=e,m(),f(),c(),A.addChild(A.removeChild(w)),I.render(q)},configurable:!0,enumerable:!0},resolution:{set:function(e){r.resolution=e,m(),f("vertical"),A.addChild(A.removeChild(w)),I.render(q)},configurable:!0,enumerable:!0},noteData:{set:function(e){r.noteData=e,m(),f("horizontal"),c(),l(),I.render(q)},configurable:!0,enumerable:!0},playing:{get:function(){return R},configurable:!0,enumerable:!0},view:{get:function(){return I.view},configurable:!0,enumerable:!0}});return L}var o=function(){function e(e,i){var n=[],r=!0,o=!1,t=void 0;try{for(var a,l=e[Symbol.iterator]();!(r=(a=l.next()).done)&&(n.push(a.value),!i||n.length!==i);r=!0);}catch(d){o=!0,t=d}finally{try{!r&&l["return"]&&l["return"]()}finally{if(o)throw t}}return n}return function(i,n){if(Array.isArray(i))return i;if(Symbol.iterator in Object(i))return e(i,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();return r});