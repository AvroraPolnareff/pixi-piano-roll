!function(e,r){"function"==typeof define&&define.amd?define(["pixi.js","teoria"],r):"object"==typeof exports?module.exports=r(require("pixi.js"),require("teoria")):e.pixiPianoRoll=r(e.PIXI,e.teoria)}(this,function(e,r){"use strict";function t(i){function o(){var e,t;return i.noteData.forEach(function(n){var i=r.note(n[1]).key();(e>i||"number"!=typeof e)&&(e=i),(i>t||"number"!=typeof t)&&(t=i)}),{min:e-1,max:t}}function a(){m.addChild((new e.Graphics).clear().beginFill(i.backgroundColor).drawRect(0,0,i.width,i.height).endFill())}function l(e){var r=e.split(":"),t=n(r,3),i=t[0],o=t[1],a=void 0===o?0:o,l=t[2],c=void 0===l?0:l;return g*i+F*a+w*c}function c(){var t=!0,o=!1,a=void 0;try{for(var c,u=function(){var t=n(c.value,3),o=t[0],a=t[1],u=t[2],d=i.noteColor,f=new e.Graphics,h=r.note(a),v=l(o)+A,s=i.height-(h.key()-C.min)*E+A,y=g/parseInt(u);"object"==typeof d&&Object.keys(d).forEach(function(e){r.note(e).chroma()===h.chroma()&&(d=d[e])}),p.addChild(f),f.beginFill(d).drawRect(v,s,y,j).endFill()},d=i.noteData[Symbol.iterator]();!(t=(c=d.next()).done);t=!0)u()}catch(f){o=!0,a=f}finally{try{!t&&d["return"]&&d["return"]()}finally{if(o)throw a}}m.addChild(p),p.x=-l(i.time)}function u(e){if("string"!=typeof e)return u("horizontal"),void u("vertical");var r="vertical"===e?x:i.width,t="vertical"===e?i.height:x,n=!0,o=!1,a=void 0;try{for(var l,c=z[e][Symbol.iterator]();!(n=(l=c.next()).done);n=!0){var d=l.value;d.graphic.clear().beginFill(i.gridLineColor).drawRect(d.x,d.y,r,t).endFill()}}catch(f){o=!0,a=f}finally{try{!n&&c["return"]&&c["return"]()}finally{if(o)throw a}}}function d(e){var r=!0,t=!1,n=void 0;try{for(var i,o=z.vertical[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){var a=i.value;a.x=a.x-e}}catch(l){t=!0,n=l}finally{try{!r&&o["return"]&&o["return"]()}finally{if(t)throw n}}if(z.vertical[0].x+x<0){var a=z.vertical.shift();a.x=z.vertical[z.vertical.length-1].x+B,z.vertical.push(a)}}function f(){var r=void 0;for(r=0;b+1>r;r++){var t=new e.Graphics;z.horizontal.push({x:0,y:r*E-A,graphic:t}),m.addChild(t)}for(r=0;r<i.zoom*i.resolution+1;r++){var t=new e.Graphics;z.vertical.push({x:r*B-A,y:0,graphic:t}),m.addChild(t)}}function h(e){v||(v=e);var r=e-v,t=r*G;p.x=p.x-t,d(t),u("vertical"),v=e,y.render(m),s?requestAnimationFrame(h):v=null}i=Object.assign({width:900,height:400,noteColor:t.colorscales.dDJameson,gridLineColor:3355443,backgroundColor:0,bpm:140,antialias:!0,zoom:4,resolution:2,time:"0:0:0",renderer:"WebGLRenderer",noteData:[]},i);var v=void 0,s=!1,y=new e[i.renderer](i.width,i.height,{antialias:i.antialias}),m=new e.Container,p=new e.Container,C=o(i.noteData),b=C.max-C.min,g=i.width/i.zoom,F=i.width/(4*i.zoom),w=F/4,D=i.bpm/60/1e3,G=F*D,x=g/100,A=x/2,B=g/i.resolution,E=i.height/b,j=E-x,z={horizontal:[],vertical:[]};return a(),f(),u(),c(),y.render(m),Object.defineProperties({play:function(){s=!0,requestAnimationFrame(h)},pause:function(){s=!1}},{playing:{get:function(){return s},configurable:!0,enumerable:!0},view:{get:function(){return y.view},configurable:!0,enumerable:!0}})}var n=function(){function e(e,r){var t=[],n=!0,i=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(n=(a=l.next()).done)&&(t.push(a.value),!r||t.length!==r);n=!0);}catch(c){i=!0,o=c}finally{try{!n&&l["return"]&&l["return"]()}finally{if(i)throw o}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();return t.colorscales={louisBertrandCastel:{C:1838466,"C#":1806465,D:1347635,"D#":7377446,E:16118844,F:16110139,"F#":16285712,G:16386828,"G#":10488841,A:14095238,"A#":4918909,B:8325244},dDJameson:{C:16386828,"C#":16008978,D:16285712,"D#":16110139,E:16118844,F:1347635,"F#":1806465,G:1838466,"G#":4918909,A:8325244,"A#":10884486,B:14094981},theodorSeemann:{C:6954012,"C#":16386828,D:16743685,"D#":16569651,E:16118844,F:1478708,"F#":1806465,G:1838466,"G#":8325244,A:14095238,"A#":6954012,B:460551},aWallaceRimington:{C:16386828,"C#":10488841,D:16008978,"D#":16285712,E:16118844,F:7377446,"F#":1347635,G:2532992,"G#":1806465,A:8325244,"A#":1838466,B:14095238},hHelmholtz:{C:16118844,"C#":1347635,D:1806465,"D#":1858464,E:8325244,F:14095238,"F#":10292821,G:16386828,"G#":13839370,A:13839370,"A#":14227793,B:15825423},aScriabin:{C:16386828,"C#":14095238,D:16118844,"D#":5920389,E:1858464,F:10488841,"F#":1838466,G:16285712,"G#":8325756,A:1347635,"A#":5920389,B:1858464},aBernardKlein:{C:12847625,"C#":16386828,D:16008978,"D#":16285712,E:16118844,F:12378169,"F#":1347635,G:1806465,"G#":1838466,A:7870599,"A#":14095238,B:10292821},iJBelmont:{C:16386828,"C#":16008978,D:16285712,"D#":16175377,E:16118844,F:12378169,"F#":1281842,G:1806465,"G#":1838466,A:10818949,"A#":14095238,B:11341384},sZieverink:{C:12378169,"C#":1347635,D:1806465,"D#":1838466,E:8325244,F:14095238,"F#":7277893,G:10488841,"G#":16386828,A:16285712,"A#":15593607,B:16118844}},t});