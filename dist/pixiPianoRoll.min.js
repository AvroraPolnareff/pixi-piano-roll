!function(e,r){"function"==typeof define&&define.amd?define(["pixi.js","teoria","musical-scale-colors"],r):"object"==typeof exports?module.exports=r(require("pixi.js"),require("teoria"),require("musical-scale-colors")):e.pixiPianoRoll=r(e.PIXI,e.teoria,e.musicalScaleColors)}(this,function(e,r,t){"use strict";function i(i){function o(e){w=e/60/1e3,b=R*w}function a(e){var t=r.note["from"+i.noteFormat](e);return"Frequency"===i.noteFormat?t.note:t}function l(){var e,r;return i.noteData.forEach(function(t){var i=a(t[1]).key();(e>i||"number"!=typeof e)&&(e=i),(i>r||"number"!=typeof r)&&(r=i)}),{min:e-1,max:r}}function c(){for(var t=[],n=[],o=G/2*j,a=o/1.575,l=z.min;l<z.max+2;l++){var c=i.height+(z.min-l)*O,u=r.note.fromKey(l),h=u.chroma();new Set([0,2,4,5,7,9,11]).has(h)?t.push({y:c+(new Set([4,11]).has(h)?0:-O/2),width:o,height:new Set([2,7,9]).has(h)?2*O:1.5*O,color:m.white}):n.push({y:c,width:a,height:O,color:m.black})}t.concat(n).forEach(function(r){k.addChild((new e.Graphics).beginFill(r.color).lineStyle(r.color===m.white?A:0,m.black).drawRect(0,r.y,r.width,r.height).endFill())}),C.addChild(k)}function u(){S.addChild((new e.Graphics).beginFill(i.backgroundColor).drawRect(0,0,i.width,i.height).endFill())}function h(e){if(!e)return 0;var r=e.split(":"),t=n(r,3),i=t[0],o=t[1],a=void 0===o?0:o,l=t[2],c=void 0===l?0:l;return G*i+R*a+D*c}function d(){var t=!0,o=!1,l=void 0;try{for(var c,u=function(){var t=n(c.value,3),o=t[0],l=t[1],u=t[2],d=i.noteColor,f=new e.Graphics,v=a(l),s=h(o)+E,y=i.height-(v.key()-z.min)*O+E,m=G/parseInt(u);"object"==typeof d&&Object.keys(d).forEach(function(e){r.note(e).chroma()===v.chroma()&&(d=d[e])}),F.addChild(f),f.beginFill(d).drawRect(s,y,m,L).endFill()},d=i.noteData[Symbol.iterator]();!(t=(c=d.next()).done);t=!0)u()}catch(f){o=!0,l=f}finally{try{!t&&d["return"]&&d["return"]()}finally{if(o)throw l}}F.x=-h(i.time),S.addChild(F),S.width=S.width*j,S.x=i.width*(1-j),C.addChild(S)}function f(e){if("string"!=typeof e)return f("horizontal"),void f("vertical");var r="vertical"===e?A:i.width,t="vertical"===e?i.height:A,n=!0,o=!1,a=void 0;try{for(var l,c=P[e][Symbol.iterator]();!(n=(l=c.next()).done);n=!0){var u=l.value;u.graphic.clear().beginFill(i.gridLineColor).drawRect(u.x,u.y,r,t).endFill()}}catch(h){o=!0,a=h}finally{try{!n&&c["return"]&&c["return"]()}finally{if(o)throw a}}}function v(e){var r=!0,t=!1,i=void 0;try{for(var n,o=P.vertical[Symbol.iterator]();!(r=(n=o.next()).done);r=!0){var a=n.value;a.x=a.x-e}}catch(l){t=!0,i=l}finally{try{!r&&o["return"]&&o["return"]()}finally{if(t)throw i}}if(P.vertical[0].x+A<0){var a=P.vertical.shift();a.x=P.vertical[P.vertical.length-1].x+I,P.vertical.push(a)}}function s(){var r=void 0;for(r=0;q+1>r;r++){var t=new e.Graphics;P.horizontal.push({x:0,y:r*O-E,graphic:t}),S.addChild(t)}for(r=0;r<i.zoom*i.resolution+1;r++){var t=new e.Graphics,o=i.time.split(":"),a=n(o,3),l=(a[0],a[1]),c=void 0===l?0:l,u=a[2],h=void 0===u?0:u,d=c*R+h*D;P.vertical.push({x:r*I-E-d,y:0,graphic:t}),S.addChild(t)}}function y(e){p||(p=e);var r=e-p,t=r*b;F.x=F.x-t,v(t),f("vertical"),p=e,x.render(C),g?requestAnimationFrame(y):p=null}var m={black:0,white:16777215};i=Object.assign({width:900,height:400,noteColor:t.dDJameson,gridLineColor:3355443,backgroundColor:m.black,bpm:140,antialias:!0,zoom:4,resolution:2,time:"0:0:0",renderer:"WebGLRenderer",noteFormat:"String",noteData:[]},i);var p=void 0,w=void 0,b=void 0,g=!1,x=new e[i.renderer](i.width,i.height,{antialias:i.antialias}),C=new e.Container,F=new e.Container,k=new e.Container,S=new e.Container,j=.89,z=l(i.noteData),q=z.max-z.min,G=i.width/i.zoom,R=i.width/(4*i.zoom),D=R/4,A=G/100,E=A/2,I=G/i.resolution,O=i.height/q,L=O-A,P={horizontal:[],vertical:[]};o(i.bpm),u(),s(),f(),d(),c(),x.render(C);var J=Object.defineProperties({playback:{toggle:function(e){g?J.playback.pause():J.playback.play(e)},play:function(e){var r=-h(e);r&&(v(F.x-r),F.x=r),g=!0,requestAnimationFrame(y)},pause:function(){g=!1}}},{bpm:{set:function(e){o(e)},configurable:!0,enumerable:!0},playing:{get:function(){return g},configurable:!0,enumerable:!0},view:{get:function(){return x.view},configurable:!0,enumerable:!0}});return J}var n=function(){function e(e,r){var t=[],i=!0,n=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(i=(a=l.next()).done)&&(t.push(a.value),!r||t.length!==r);i=!0);}catch(c){n=!0,o=c}finally{try{!i&&l["return"]&&l["return"]()}finally{if(n)throw o}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();return i});