!function(e,i){"function"==typeof define&&define.amd?define(["pixi.js","teoria","musical-scale-colors"],i):"object"==typeof exports?module.exports=i(require("pixi.js"),require("teoria"),require("musical-scale-colors")):e.pixiPianoRoll=i(e.PIXI,e.teoria,e.musicalScaleColors)}(this,function(e,i,n){"use strict";function r(r){function o(e){var n=i.note["from"+r.noteFormat](e);return"Frequency"===r.noteFormat?n.note:n}function a(){var e=void 0,i=void 0,n=!0,a=!1,l=void 0;try{for(var d,c=r.noteData[Symbol.iterator]();!(n=(d=c.next()).done);n=!0){var h=t(d.value,2),u=h[1],v=o(u).key();(e>v||"number"!=typeof e)&&(e=v),(v>i||"number"!=typeof i)&&(i=v)}}catch(f){a=!0,l=f}finally{try{!n&&c["return"]&&c["return"]()}finally{if(a)throw l}}return{min:e-1,max:i}}function l(){var n=[],t=[],o=r.pianoKeyWidth/1.575;G.removeChild(k),k=new e.Container;for(var a=C.min;a<C.max+2;a++){var l=r.height+(C.min-a)*x,d=i.note.fromKey(a),c=d.chroma();new Set([0,2,4,5,7,9,11]).has(c)?n.push({y:l+(new Set([4,11]).has(c)?0:-x/2),width:r.pianoKeyWidth,height:new Set([2,7,9]).has(c)?2*x:1.5*x,color:y.white}):t.push({y:l,width:o,height:x,color:y.black})}n.concat(t).forEach(function(i){k.addChild((new e.Graphics).beginFill(i.color).lineStyle(i.color===y.white?W:0,y.black).drawRect(0,i.y,i.width,i.height).endFill())}),G.addChild(k)}function d(){G.addChild((new e.Graphics).beginFill(r.backgroundColor).drawRect(0,0,r.width,r.height).endFill())}function c(e,i){if(!e)return 0;var n=e.split(":"),o=t(n,3),a=o[0],l=o[1],d=void 0===l?0:l,c=o[2],h=void 0===c?0:c,u=S*a+z*d+K*h;return i?u:r.pianoKeyWidth-u}function h(){var n=A.removeChild(w);w=new e.Container;var a=!0,l=!1,d=void 0;try{for(var h,u=function(){var n=t(h.value,3),a=n[0],l=n[1],d=n[2],u=r.noteColor,v=new e.Graphics,f=o(l),m=c(a,!0)+j,y=r.height-(f.key()-C.min)*x+j,s=S/parseInt(d);"object"==typeof u&&Object.keys(u).forEach(function(e){i.note(e).chroma()===f.chroma()&&(u=u[e])}),w.addChild(v),v.beginFill(u).drawRect(m,y,s,F).endFill()},v=r.noteData[Symbol.iterator]();!(a=(h=v.next()).done);a=!0)u()}catch(f){l=!0,d=f}finally{try{!a&&v["return"]&&v["return"]()}finally{if(l)throw d}}w.x=n?n.x:c(r.time),A.addChild(w),G.addChild(A)}function u(e){var i=I.vertical.children,n=!0,t=!1,o=void 0;try{for(var a,l=i[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var d=a.value;d.x-=e}}catch(c){t=!0,o=c}finally{try{!n&&l["return"]&&l["return"]()}finally{if(t)throw o}}if(i[0].x+W<r.pianoKeyWidth){var d=I.vertical.removeChildAt(0);d.x=i[i.length-1].x+D,I.vertical.addChild(d)}}function v(i){var n=void 0;if(!i||"horizontal"===i){for(I.main.removeChild(I.horizontal),I.horizontal=new e.Container,n=0;g+1>n;n++)I.horizontal.addChild((new e.Graphics).beginFill(r.gridLineColor).drawRect(0,n*x-j,r.width,W).endFill());I.main.addChild(I.horizontal)}if(!i||"vertical"===i){for(I.main.removeChild(I.vertical),I.vertical=new e.Container,n=0;n<r.zoom*r.resolution+1;n++){var o=r.time.split(":"),a=t(o,3),l=(a[0],a[1]),d=void 0===l?0:l,c=a[2],h=void 0===c?0:c,u=d*z+h*K,v=(new e.Graphics).beginFill(r.gridLineColor).drawRect(0,0,W,r.height).endFill();v.x=n*D-j-u+r.pianoKeyWidth,I.vertical.addChild(v)}I.main.addChild(I.vertical)}A.addChild(I.main)}function f(e){s||(s=e);var i=e-s,n=i*b;w.x=w.x-n,u(n),s=e,q.render(G),R?requestAnimationFrame(f):s=null}function m(){C=a(r.noteData),g=C.max-C.min,S=(r.width-r.pianoKeyWidth)/r.zoom,z=(r.width-r.pianoKeyWidth)/(4*r.zoom),K=z/4,W=S/100,j=W/2,D=S/r.resolution,p=r.bpm/60/1e3,b=z*p,x=r.height/g,F=x-W}var y={black:0,white:16777215};r=Object.assign({width:900,height:400,pianoKeyWidth:125,noteColor:n.dDJameson,gridLineColor:3355443,backgroundColor:y.black,bpm:140,antialias:!0,zoom:4,resolution:2,time:"0:0:0",renderer:"WebGLRenderer",noteFormat:"String",noteData:[]},r);var s=void 0,p=void 0,b=void 0,w=void 0,C=void 0,g=void 0,x=void 0,F=void 0,k=void 0,S=void 0,z=void 0,K=void 0,W=void 0,j=void 0,D=void 0,R=!1,q=new e[r.renderer](r.width,r.height,{antialias:r.antialias}),G=new e.Container,A=new e.Container,I={main:new e.Container};!function(){m(),d(),v(),h(),l(),q.render(G)}();var L=Object.defineProperties({playback:{toggle:function(e){R?L.playback.pause():L.playback.play(e)},play:function(e){R||(e&&L.playback.seek(e),R=!0,requestAnimationFrame(f))},pause:function(){R=!1},seek:function(e){r.time=e,w.x=c(e),v("vertical"),A.addChild(A.removeChild(w)),q.render(G)}}},{bpm:{set:function(e){r.bpm=e,m()},configurable:!0,enumerable:!0},noteData:{set:function(e){r.noteData=e,m(),v("horizontal"),h(),l(),q.render(G)},configurable:!0,enumerable:!0},playing:{get:function(){return R},configurable:!0,enumerable:!0},view:{get:function(){return q.view},configurable:!0,enumerable:!0}});return L}var t=function(){function e(e,i){var n=[],r=!0,t=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(r=(a=l.next()).done)&&(n.push(a.value),!i||n.length!==i);r=!0);}catch(d){t=!0,o=d}finally{try{!r&&l["return"]&&l["return"]()}finally{if(t)throw o}}return n}return function(i,n){if(Array.isArray(i))return i;if(Symbol.iterator in Object(i))return e(i,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();return r});