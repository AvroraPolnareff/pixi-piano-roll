!function(r,e){"function"==typeof define&&define.amd?define(["pixi.js","teoria"],e):"object"==typeof exports?module.exports=e(require("pixi.js"),require("teoria")):r.pixiPianoRoll=e(r.PIXI,r.teoria)}(this,function(r,e){"use strict";function t(t){function n(){var r,i;return t.noteData.forEach(function(t){var n=e.note(t[1]).key();(r>n||"number"!=typeof r)&&(r=n),(n>i||"number"!=typeof i)&&(i=n)}),{min:r-1,max:i}}function a(){s.addChild((new r.Graphics).clear().beginFill(t.backgroundColor).drawRect(0,0,t.width,t.height).endFill())}function o(r){var e=r.split(":"),t=i(e,3),n=t[0],a=t[1],o=void 0===a?0:a,l=t[2],u=void 0===l?0:l;return b*n+w*o+x*u}function l(){var n=!0,a=!1,l=void 0;try{for(var u,c=t.noteData[Symbol.iterator]();!(n=(u=c.next()).done);n=!0){var d=i(u.value,3),f=d[0],h=d[1],v=d[2],y=new r.Graphics,g=o(f)+j,w=t.height-(e.note(h).key()-m.min)*R+j,x=b/parseInt(v);p.addChild(y),y.beginFill(t.noteColor).drawRect(g,w,x,S).endFill()}}catch(C){a=!0,l=C}finally{try{!n&&c["return"]&&c["return"]()}finally{if(a)throw l}}s.addChild(p),p.x=-o(t.time)}function u(r){if("string"!=typeof r)return u("horizontal"),void u("vertical");var e="vertical"===r?z:t.width,i="vertical"===r?t.height:z,n=!0,a=!1,o=void 0;try{for(var l,c=k[r][Symbol.iterator]();!(n=(l=c.next()).done);n=!0){var d=l.value;d.graphic.clear().beginFill(t.gridLineColor).drawRect(d.x,d.y,e,i).endFill()}}catch(f){a=!0,o=f}finally{try{!n&&c["return"]&&c["return"]()}finally{if(a)throw o}}}function c(r){var e=!0,t=!1,i=void 0;try{for(var n,a=k.vertical[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var o=n.value;o.x=o.x-r}}catch(l){t=!0,i=l}finally{try{!e&&a["return"]&&a["return"]()}finally{if(t)throw i}}if(k.vertical[0].x+z<0){var o=k.vertical.shift();o.x=k.vertical[k.vertical.length-1].x+G,k.vertical.push(o)}}function d(){var e=void 0;for(e=0;g+1>e;e++){var i=new r.Graphics;k.horizontal.push({x:0,y:e*R-j,graphic:i}),s.addChild(i)}for(e=0;e<t.zoom*t.resolution+1;e++){var i=new r.Graphics;k.vertical.push({x:e*G-j,y:0,graphic:i}),s.addChild(i)}}function f(r){h||(h=r);var e=r-h,t=e*F;p.x=p.x-t,c(t),u("vertical"),h=r,y.render(s),v?requestAnimationFrame(f):h=null}t=Object.assign({width:900,height:400,noteColor:16713984,gridLineColor:1279,backgroundColor:15856113,bpm:140,antialias:!0,zoom:4,resolution:2,time:"0:0:0",renderer:"WebGLRenderer",noteData:[]},t);var h=void 0,v=!1,y=new r[t.renderer](t.width,t.height,{antialias:t.antialias}),s=new r.Container,p=new r.Container,m=n(t.noteData),g=m.max-m.min,b=t.width/t.zoom,w=t.width/(4*t.zoom),x=w/4,C=t.bpm/60/1e3,F=w*C,z=b/100,j=z/2,G=b/t.resolution,R=t.height/g,S=R-z,k={horizontal:[],vertical:[]};return a(),d(),u(),l(),y.render(s),Object.defineProperties({play:function(){v=!0,requestAnimationFrame(f)},pause:function(){v=!1}},{playing:{get:function(){return v},configurable:!0,enumerable:!0},view:{get:function(){return y.view},configurable:!0,enumerable:!0}})}var i=function(){function r(r,e){var t=[],i=!0,n=!1,a=void 0;try{for(var o,l=r[Symbol.iterator]();!(i=(o=l.next()).done)&&(t.push(o.value),!e||t.length!==e);i=!0);}catch(u){n=!0,a=u}finally{try{!i&&l["return"]&&l["return"]()}finally{if(n)throw a}}return t}return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return r(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();return t});