!function(e,i){"function"==typeof define&&define.amd?define(["pixi.js","teoria","musical-scale-colors"],i):"object"==typeof exports?module.exports=i(require("pixi.js"),require("teoria"),require("musical-scale-colors")):e.pixiPianoRoll=i(e.PIXI,e.teoria,e.musicalScaleColors)}(this,function(e,i,n){"use strict";function r(r){function o(e){var n=i.note["from"+r.noteFormat](e);return"Frequency"===r.noteFormat?n.note:n}function a(){var e=void 0,i=void 0,n=!0,a=!1,l=void 0;try{for(var d,c=r.noteData[Symbol.iterator]();!(n=(d=c.next()).done);n=!0){var h=t(d.value,2),u=h[1],f=o(u).key();(e>f||"number"!=typeof e)&&(e=f),(f>i||"number"!=typeof i)&&(i=f)}}catch(v){a=!0,l=v}finally{try{!n&&c["return"]&&c["return"]()}finally{if(a)throw l}}return{min:e-1,max:i}}function l(){var n=[],t=[],o=r.pianoKeyWidth/1.575;G.removeChild(z),z=new e.Container;for(var a=g.min;a<g.max+2;a++){var l=r.height+(g.min-a)*F,d=i.note.fromKey(a),c=d.chroma();new Set([0,2,4,5,7,9,11]).has(c)?n.push({y:l+(new Set([4,11]).has(c)?0:-F/2),width:r.pianoKeyWidth,height:new Set([2,7,9]).has(c)?2*F:1.5*F,color:y.white}):t.push({y:l,width:o,height:F,color:y.black})}n.concat(t).forEach(function(i){z.addChild((new e.Graphics).beginFill(i.color).lineStyle(i.color===y.white?F/10:0,y.black).drawRect(0,i.y,i.width,i.height).endFill())}),G.addChild(z)}function d(){G.addChild((new e.Graphics).beginFill(r.backgroundColor).drawRect(0,0,r.width,r.height).endFill())}function c(e,i){if(!e)return 0;var n=e.split(":"),o=t(n,3),a=o[0],l=o[1],d=void 0===l?0:l,c=o[2],h=void 0===c?0:c,u=S*a+K*d+W*h;return i?u:r.pianoKeyWidth-u}function h(){var n=A.removeChild(C);C=new e.Container;var a=!0,l=!1,d=void 0;try{for(var h,u=function(){var n=t(h.value,3),a=n[0],l=n[1],d=n[2],u=r.noteColor,f=new e.Graphics,v=o(l),m=c(a,!0)+R,s=r.height-(v.key()-g.min)*F+R,y=S/parseInt(d);"object"==typeof u&&Object.keys(u).forEach(function(e){i.note(e).chroma()===v.chroma()&&(u=u[e])}),C.addChild(f),f.beginFill(u).drawRect(m,s,y,k).endFill()},f=r.noteData[Symbol.iterator]();!(a=(h=f.next()).done);a=!0)u()}catch(v){l=!0,d=v}finally{try{!a&&f["return"]&&f["return"]()}finally{if(l)throw d}}C.x=n?n.x:c(r.time),A.addChild(C),G.addChild(A)}function u(e){var i=I.vertical.children,n=!0,t=!1,o=void 0;try{for(var a,l=i[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var d=a.value;d.x-=e}}catch(c){t=!0,o=c}finally{try{!n&&l["return"]&&l["return"]()}finally{if(t)throw o}}if(i[0].x+j<r.pianoKeyWidth){var d=I.vertical.removeChildAt(0);d.x=i[i.length-1].x+D,I.vertical.addChild(d)}}function f(e){for(var i=e;i+D<r.pianoKeyWidth;)i+=D;return i}function v(i){var n=void 0;if(!i||"horizontal"===i){for(I.main.removeChild(I.horizontal),I.horizontal=new e.Container,n=0;x+1>n;n++)I.horizontal.addChild((new e.Graphics).beginFill(r.gridLineColor).drawRect(0,n*F-R,r.width,j).endFill());I.main.addChild(I.horizontal)}if(!i||"vertical"===i){var t=f(C?C.x:c(r.time));for(I.main.removeChild(I.vertical),I.vertical=new e.Container,n=0;n<r.zoom*r.resolution+1;n++){var o=(new e.Graphics).beginFill(r.gridLineColor).drawRect(0,0,j,r.height).endFill();o.x=t+n*D-R,I.vertical.addChild(o)}I.main.addChild(I.vertical)}A.addChild(I.main)}function m(e){b||(b=e);var i=e-b,n=i*w;C.x=C.x-n,u(n),b=e,L.render(G),q?requestAnimationFrame(m):b=null}function s(){g=a(r.noteData),x=g.max-g.min,S=(r.width-r.pianoKeyWidth)/r.zoom,K=(r.width-r.pianoKeyWidth)/(4*r.zoom),W=K/4,j=S/100,R=j/2,D=S/r.resolution,p=r.bpm/60/1e3,w=K*p,F=r.height/x,k=F-j}var y={black:0,white:16777215};r=Object.assign({width:900,height:400,pianoKeyWidth:125,noteColor:n.dDJameson,gridLineColor:3355443,backgroundColor:y.black,bpm:140,antialias:!0,zoom:4,resolution:2,time:"0:0:0",renderer:"WebGLRenderer",noteFormat:"String",noteData:[]},r);var b=void 0,p=void 0,w=void 0,C=void 0,g=void 0,x=void 0,F=void 0,k=void 0,z=void 0,S=void 0,K=void 0,W=void 0,j=void 0,R=void 0,D=void 0,q=!1,G=new e.Container,A=new e.Container,I={main:new e.Container},L=new e[r.renderer](r.width,r.height,{antialias:r.antialias,autoResize:!0});!function(){s(),d(),v(),h(),l(),L.render(G)}();var O=Object.defineProperties({playback:{toggle:function(e){q?O.playback.pause():O.playback.play(e)},play:function(e){q||(e&&O.playback.seek(e),q=!0,requestAnimationFrame(m))},pause:function(){q=!1},seek:function(e){r.time=e,C.x=c(e),v("vertical"),A.addChild(A.removeChild(C)),L.render(G)}}},{bpm:{set:function(e){r.bpm=e,s()},configurable:!0,enumerable:!0},zoom:{set:function(e){r.zoom=e,s(),v(),h(),A.addChild(A.removeChild(C)),L.render(G)},configurable:!0,enumerable:!0},resolution:{set:function(e){r.resolution=e,s(),v("vertical"),A.addChild(A.removeChild(C)),L.render(G)},configurable:!0,enumerable:!0},noteData:{set:function(e){r.noteData=e,s(),v("horizontal"),h(),l(),L.render(G)},configurable:!0,enumerable:!0},playing:{get:function(){return q},configurable:!0,enumerable:!0},view:{get:function(){return L.view},configurable:!0,enumerable:!0}});return O}var t=function(){function e(e,i){var n=[],r=!0,t=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(r=(a=l.next()).done)&&(n.push(a.value),!i||n.length!==i);r=!0);}catch(d){t=!0,o=d}finally{try{!r&&l["return"]&&l["return"]()}finally{if(t)throw o}}return n}return function(i,n){if(Array.isArray(i))return i;if(Symbol.iterator in Object(i))return e(i,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();return r});