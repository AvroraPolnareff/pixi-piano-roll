!function(e,r){"function"==typeof define&&define.amd?define(["pixi.js","teoria","musical-scale-colors"],r):"object"==typeof exports?module.exports=r(require("pixi.js"),require("teoria"),require("musical-scale-colors")):e.pixiPianoRoll=r(e.PIXI,e.teoria,e.musicalScaleColors)}(this,function(e,r,t){"use strict";function i(i){function o(){var e,t;return i.noteData.forEach(function(i){var n=r.note(i[1]).key();(e>n||"number"!=typeof e)&&(e=n),(n>t||"number"!=typeof t)&&(t=n)}),{min:e-1,max:t}}function a(){for(var t=[],n=[],o=k/2*C,a=o/1.575,l=F.min+1;l<F.max+1;l++){var c=i.height+(F.min-l)*E,h=r.note.fromKey(l),u=h.chroma();new Set([0,2,4,5,7,9,11]).has(u)?t.push({y:c+(new Set([4,11]).has(u)?0:-E/2),width:o,height:new Set([2,7,9]).has(u)?2*E:1.5*E,color:s.white}):n.push({y:c,width:a,height:E,color:s.black})}t.concat(n).forEach(function(r){g.addChild((new e.Graphics).beginFill(r.color).lineStyle(r.color===s.white?q:0,s.black).drawRect(0,r.y,r.width,r.height).endFill())}),p.addChild(g)}function l(){x.addChild((new e.Graphics).clear().beginFill(i.backgroundColor).drawRect(0,0,i.width,i.height).endFill())}function c(e){var r=e.split(":"),t=n(r,3),i=t[0],o=t[1],a=void 0===o?0:o,l=t[2],c=void 0===l?0:l;return k*i+j*a+z*c}function h(){var t=!0,o=!1,a=void 0;try{for(var l,h=function(){var t=n(l.value,3),o=t[0],a=t[1],h=t[2],u=i.noteColor,d=new e.Graphics,f=r.note(a),v=c(o)+D,s=i.height-(f.key()-F.min)*E+D,y=k/parseInt(h);"object"==typeof u&&Object.keys(u).forEach(function(e){r.note(e).chroma()===f.chroma()&&(u=u[e])}),b.addChild(d),d.beginFill(u).drawRect(v,s,y,I).endFill()},u=i.noteData[Symbol.iterator]();!(t=(l=u.next()).done);t=!0)h()}catch(d){o=!0,a=d}finally{try{!t&&u["return"]&&u["return"]()}finally{if(o)throw a}}b.x=-c(i.time),x.addChild(b),x.width=x.width*C,x.x=i.width*(1-C),p.addChild(x)}function u(e){if("string"!=typeof e)return u("horizontal"),void u("vertical");var r="vertical"===e?q:i.width,t="vertical"===e?i.height:q,n=!0,o=!1,a=void 0;try{for(var l,c=O[e][Symbol.iterator]();!(n=(l=c.next()).done);n=!0){var h=l.value;h.graphic.clear().beginFill(i.gridLineColor).drawRect(h.x,h.y,r,t).endFill()}}catch(d){o=!0,a=d}finally{try{!n&&c["return"]&&c["return"]()}finally{if(o)throw a}}}function d(e){var r=!0,t=!1,i=void 0;try{for(var n,o=O.vertical[Symbol.iterator]();!(r=(n=o.next()).done);r=!0){var a=n.value;a.x=a.x-e}}catch(l){t=!0,i=l}finally{try{!r&&o["return"]&&o["return"]()}finally{if(t)throw i}}if(O.vertical[0].x+q<0){var a=O.vertical.shift();a.x=O.vertical[O.vertical.length-1].x+A,O.vertical.push(a)}}function f(){var r=void 0;for(r=0;S+1>r;r++){var t=new e.Graphics;O.horizontal.push({x:0,y:r*E-D,graphic:t}),x.addChild(t)}for(r=0;r<i.zoom*i.resolution+1;r++){var t=new e.Graphics;O.vertical.push({x:r*A-D,y:0,graphic:t}),x.addChild(t)}}function v(e){y||(y=e);var r=e-y,t=r*R;b.x=b.x-t,d(t),u("vertical"),y=e,w.render(p),m?requestAnimationFrame(v):y=null}var s={black:0,white:16777215};i=Object.assign({width:900,height:400,noteColor:t.dDJameson,gridLineColor:3355443,backgroundColor:s.black,bpm:140,antialias:!0,zoom:4,resolution:2,time:"0:0:0",renderer:"WebGLRenderer",noteData:[]},i);var y=void 0,m=!1,w=new e[i.renderer](i.width,i.height,{antialias:i.antialias}),p=new e.Container,b=new e.Container,g=new e.Container,x=new e.Container,C=.89,F=o(i.noteData),S=F.max-F.min,k=i.width/i.zoom,j=i.width/(4*i.zoom),z=j/4,G=i.bpm/60/1e3,R=j*G,q=k/100,D=q/2,A=k/i.resolution,E=i.height/S,I=E-q,O={horizontal:[],vertical:[]};return l(),f(),u(),h(),a(),w.render(p),Object.defineProperties({play:function(){m=!0,requestAnimationFrame(v)},pause:function(){m=!1}},{playing:{get:function(){return m},configurable:!0,enumerable:!0},view:{get:function(){return w.view},configurable:!0,enumerable:!0}})}var n=function(){function e(e,r){var t=[],i=!0,n=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(i=(a=l.next()).done)&&(t.push(a.value),!r||t.length!==r);i=!0);}catch(c){n=!0,o=c}finally{try{!i&&l["return"]&&l["return"]()}finally{if(n)throw o}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();return i});