!function(e,r){"function"==typeof define&&define.amd?define(["pixi.js","teoria","musical-scale-colors"],r):"object"==typeof exports?module.exports=r(require("pixi.js"),require("teoria"),require("musical-scale-colors")):e.pixiPianoRoll=r(e.PIXI,e.teoria,e.musicalScaleColors)}(this,function(e,r,i){"use strict";function n(n){function o(e){var i=r.note["from"+n.noteFormat](e);return"Frequency"===n.noteFormat?i.note:i}function a(){var e=void 0,r=void 0,i=!0,a=!1,l=void 0;try{for(var d,c=n.noteData[Symbol.iterator]();!(i=(d=c.next()).done);i=!0){var u=t(d.value,2),h=u[1],v=o(h).key();(e>v||"number"!=typeof e)&&(e=v),(v>r||"number"!=typeof r)&&(r=v)}}catch(f){a=!0,l=f}finally{try{!i&&c["return"]&&c["return"]()}finally{if(a)throw l}}return{min:e-1,max:r}}function l(r,i){return(r.graphic||new e.Graphics).clear().beginFill(i?r.activeColor:r.color).lineStyle(r.color===b.white?F/10:0,b.black).drawRect(0,r.y,r.width,r.height).endFill()}function d(){var i=[],t=[],o=n.pianoKeyWidth/1.575;p={},P.removeChild(K),K=new e.Container;for(var a=k.min;a<k.max+2;a++){var d=n.height+(k.min-a)*F,c=r.note.fromKey(a),u=c.chroma(),h={keyNumber:c.key(),activeColor:"number"==typeof n.noteColor?n.noteColor:n.noteColor[u]};new Set([0,2,4,5,7,9,11]).has(u)?i.push(Object.assign(h,{y:d+(new Set([4,11]).has(u)?0:-F/2),width:n.pianoKeyWidth,height:new Set([2,7,9]).has(u)?2*F:1.5*F,color:b.white})):t.push(Object.assign(h,{y:d,width:o,height:F,color:b.black}))}i.concat(t).forEach(function(e){var r=l(e);p[e.keyNumber]=Object.assign(e,{graphic:r}),K.addChild(r)}),P.addChild(K)}function c(e,r){if(!e)return 0;var i=e.split(":"),o=t(i,3),a=o[0],l=o[1],d=void 0===l?0:l,c=o[2],u=void 0===c?0:c,h=W*a+j*d+D*u;return r?h:n.pianoKeyWidth-h}function u(){var r=I.removeChild(x);x=new e.Container;var i=!0,a=!1,l=void 0;try{for(var d,u=n.noteData[Symbol.iterator]();!(i=(d=u.next()).done);i=!0){var h=t(d.value,3),v=h[0],f=h[1],y=h[2],m=new e.Graphics,s=o(f),b=s.key(),p="number"==typeof n.noteColor?n.noteColor:n.noteColor[s.chroma()];m.beginFill(p).drawRect(0,0,W/parseInt(y),z).endFill(),m.x=c(v,!0)+q,m.y=n.height-(b-k.min)*F+q,m.keyNumber=b,x.addChild(m)}}catch(w){a=!0,l=w}finally{try{!i&&u["return"]&&u["return"]()}finally{if(a)throw l}}x.x=r?r.x:c(n.time),I.addChild(x)}function h(e){var r=L.vertical.children,i=!0,t=!1,o=void 0;try{for(var a,l=r[Symbol.iterator]();!(i=(a=l.next()).done);i=!0){var d=a.value;d.x-=e}}catch(c){t=!0,o=c}finally{try{!i&&l["return"]&&l["return"]()}finally{if(t)throw o}}if(r[0].x+R<n.pianoKeyWidth){var d=L.vertical.removeChildAt(0);d.x=r[r.length-1].x+O,L.vertical.addChild(d)}}function v(e){for(var r=e;r+O<n.pianoKeyWidth;)r+=O;return r}function f(r){var i=void 0;if(!r||"horizontal"===r){for(L.main.removeChild(L.horizontal),L.horizontal=new e.Container,i=0;S+1>i;i++)L.horizontal.addChild((new e.Graphics).beginFill(n.gridLineColor).drawRect(0,i*F-q,n.width,R).endFill());L.main.addChild(L.horizontal)}if(!r||"vertical"===r){var t=v(x?x.x:c(n.time));for(L.main.removeChild(L.vertical),L.vertical=new e.Container,i=0;i<n.zoom*n.resolution+1;i++){var o=(new e.Graphics).beginFill(n.gridLineColor).drawRect(0,0,R,n.height).endFill();o.x=t+i*O-q,L.vertical.addChild(o)}L.main.addChild(L.vertical)}I.addChild(L.main)}function y(){if(n.activateKeys){var r=new Set,i=!0,t=!1,o=void 0;try{for(var a,d=x.children[Symbol.iterator]();!(i=(a=d.next()).done);i=!0){var c=a.value;c.containsPoint(new e.Point(n.pianoKeyWidth,c.y))&&r.add(c.keyNumber)}}catch(u){t=!0,o=u}finally{try{!i&&d["return"]&&d["return"]()}finally{if(t)throw o}}var h=!0,v=!1,f=void 0;try{for(var y,m=r[Symbol.iterator]();!(h=(y=m.next()).done);h=!0){var s=y.value;if(!A.has(s)){var b=p[s];l(b,!0),A.add(s)}}}catch(u){v=!0,f=u}finally{try{!h&&m["return"]&&m["return"]()}finally{if(v)throw f}}var w=!0,C=!1,g=void 0;try{for(var k,S=A[Symbol.iterator]();!(w=(k=S.next()).done);w=!0){var F=k.value;if(!r.has(F)){var b=p[F];l(b),A["delete"](F)}}}catch(u){C=!0,g=u}finally{try{!w&&S["return"]&&S["return"]()}finally{if(C)throw g}}}}function m(e){w||(w=e);var r=e-w,i=r*g;x.x=x.x-i,h(i),y(),w=e,N.render(P),G?requestAnimationFrame(m):w=null}function s(){k=a(n.noteData),S=k.max-k.min,W=(n.width-n.pianoKeyWidth)/n.zoom,j=(n.width-n.pianoKeyWidth)/(4*n.zoom),D=j/4,R=W/100,q=R/2,O=W/n.resolution,C=n.bpm/60/1e3,g=j*C,F=n.height/S,z=F-R}var b={black:0,white:16777215};n=Object.assign({width:900,height:400,pianoKeyWidth:125,noteColor:i.dDJameson,gridLineColor:3355443,backgroundColor:b.black,bpm:140,activateKeys:!0,antialias:!0,zoom:4,resolution:1,time:"0:0:0",renderer:"WebGLRenderer",noteFormat:"String",noteData:[]},n);var p=void 0,w=void 0,C=void 0,g=void 0,x=void 0,k=void 0,S=void 0,F=void 0,z=void 0,K=void 0,W=void 0,j=void 0,D=void 0,R=void 0,q=void 0,O=void 0,A=new Set,G=!1,P=new e.Container,I=new e.Container,L={main:new e.Container},N=new e[n.renderer](n.width,n.height,{antialias:n.antialias,autoResize:!0});!function(){P.addChild(I),s(),f(),u(),d(),N.backgroundColor=n.backgroundColor,N.render(P)}();var E=Object.defineProperties({playback:{toggle:function(e){G?E.playback.pause():E.playback.play(e)},play:function(e){G||(e&&E.playback.seek(e),G=!0,requestAnimationFrame(m))},pause:function(){G=!1},seek:function(e){n.time=e,x.x=c(e),f("vertical"),I.addChild(I.removeChild(x)),N.render(P)}}},{bpm:{set:function(e){n.bpm=e,s()},configurable:!0,enumerable:!0},zoom:{set:function(e){n.zoom=e,s(),f(),u(),N.render(P)},configurable:!0,enumerable:!0},resolution:{set:function(e){n.resolution=e,s(),f("vertical"),I.addChild(I.removeChild(x)),N.render(P)},configurable:!0,enumerable:!0},noteData:{set:function(e){n.noteData=e,s(),f("horizontal"),u(),d(),N.render(P)},configurable:!0,enumerable:!0},playing:{get:function(){return G},configurable:!0,enumerable:!0},view:{get:function(){return N.view},configurable:!0,enumerable:!0}});return E}var t=function(){function e(e,r){var i=[],n=!0,t=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(n=(a=l.next()).done)&&(i.push(a.value),!r||i.length!==r);n=!0);}catch(d){t=!0,o=d}finally{try{!n&&l["return"]&&l["return"]()}finally{if(t)throw o}}return i}return function(r,i){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();return n});